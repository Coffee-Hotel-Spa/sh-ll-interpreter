#!/usr/bin/env shæll


fn strip_whitespace(str)
    exec echo~(str) -> exec xargs -> let rv
    return rv
end

fn startswith(str, startstr)
    return str:substring(0, startstr:length()) == str
end

if args:length() == 0 then
	exec echo~("expected username as argument")
	exit(1)
end

let color_fix = "<span> </span>"

let status = exec sts~("-u", args[0], "-b", "--strandvejen") -> let sts_out

if status != 0 then
	exec echo~("${color_fix}<span color='#02bfe7'>~~</span> -\$")
	exec echo~("---")
	exec echo~("fejl: ${strip_whitespace(sts_out)}")
	exit(0)
end

let sportcola_pris = 6
let balance = +strip_whitespace(sts_out)
let sportcola_koefficient = balance / sportcola_pris

if sportcola_koefficient < 1 then
	exec echo~("${color_fix}<span color='#F00'>${balance} -\$!!!!</span>")
else
  if sportcola_koefficient < 2 then
	  exec echo~("${color_fix}<span color='#FA0'>${balance}</span> -\$")
  else
	  exec echo~("${color_fix}<span color='#0F0'>${balance}</span> -\$")
  end
end
exec echo~("---")

let korrekt_grammatik

if sportcola_koefficient == 1 then
	korrekt_grammatik = "sportcola"
else
	korrekt_grammatik = "sportcolaer"
end

exec printf~("Du kan købe %.2f ${korrekt_grammatik}\n", sportcola_koefficient)
exec echo~("Stregsystem hjemmeside | href='https://stregsystem.fklub.dk/10/sale/4063/'")
